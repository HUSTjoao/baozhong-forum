# ğŸ” æ³¨å†ŒåŠŸèƒ½é—®é¢˜è¯Šæ–­æ­¥éª¤

## åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé€æ­¥æ£€æŸ¥ï¼š

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦å·²æ›´æ–°

```bash
cd /root/baozhong-forum
git pull
git log --oneline -5
# ç¡®è®¤æœ€æ–°çš„æäº¤åŒ…å« "Migrate authentication to database"
```

### æ­¥éª¤ 2ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®

```bash
# æ£€æŸ¥ .env.local æˆ– .env æ–‡ä»¶
cat .env.local | grep DATABASE_URL
# æˆ–
cat .env | grep DATABASE_URL

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# DATABASE_URL="postgresql://ç”¨æˆ·å:å¯†ç @åœ°å€:5432/æ•°æ®åº“å"
```

### æ­¥éª¤ 3ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

```bash
# æµ‹è¯• Prisma è¿æ¥
npx prisma db pull
# å¦‚æœæˆåŠŸï¼Œè¯´æ˜æ•°æ®åº“è¿æ¥æ­£å¸¸
```

### æ­¥éª¤ 4ï¼šæ£€æŸ¥ Prisma Client æ˜¯å¦ç”Ÿæˆ

```bash
# é‡æ–°ç”Ÿæˆ Prisma Client
npx prisma generate

# æ£€æŸ¥æ˜¯å¦ç”ŸæˆæˆåŠŸ
ls -la node_modules/.prisma/client/
```

### æ­¥éª¤ 5ï¼šæ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…

```bash
# æ£€æŸ¥ bcryptjs æ˜¯å¦å®‰è£…
npm list bcryptjs

# å¦‚æœæ²¡æœ‰ï¼Œå®‰è£…ä¾èµ–
npm install
```

### æ­¥éª¤ 6ï¼šæ£€æŸ¥ API è·¯ç”±æ–‡ä»¶

```bash
# æ£€æŸ¥æ³¨å†Œ API æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ­£ç¡®
cat app/api/auth/register/route.ts | head -20

# åº”è¯¥çœ‹åˆ°ï¼š
# import { prisma } from '@/lib/prisma'
# import bcrypt from 'bcryptjs'
```

### æ­¥éª¤ 7ï¼šé‡å¯æœåŠ¡å¹¶æŸ¥çœ‹æ—¥å¿—

```bash
# åœæ­¢ PM2
pm2 stop baozhong-forum

# æ¸…ç† Next.js ç¼“å­˜
rm -rf .next

# é‡æ–°æ„å»º
npm run build

# å¯åŠ¨ PM2
pm2 start npm --name "baozhong-forum" -- start

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
pm2 logs baozhong-forum --lines 50
```

### æ­¥éª¤ 8ï¼šæµ‹è¯•æ³¨å†Œ APIï¼ˆç›´æ¥è°ƒç”¨ï¼‰

```bash
# æµ‹è¯•æ³¨å†Œ API æ˜¯å¦å¯è®¿é—®
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "test123456",
    "email": "test@example.com"
  }'

# æŸ¥çœ‹è¿”å›çš„é”™è¯¯ä¿¡æ¯
```

### æ­¥éª¤ 9ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ç½‘ç«™
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° "Network" æ ‡ç­¾
4. å°è¯•æ³¨å†Œ
5. æŸ¥çœ‹ `/api/auth/register` è¯·æ±‚ï¼š
   - çŠ¶æ€ç æ˜¯ä»€ä¹ˆï¼Ÿ
   - å“åº”å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ
   - æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ï¼Ÿ

### æ­¥éª¤ 10ï¼šæ£€æŸ¥æœåŠ¡å™¨é”™è¯¯æ—¥å¿—

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs baozhong-forum --err --lines 100

# æŸ¥æ‰¾åŒ…å« "register" æˆ– "error" çš„æ—¥å¿—
```

## ğŸ¯ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** é”™è¯¯ä¿¡æ¯åŒ…å« "P1001" æˆ– "connect"

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ DATABASE_URL æ˜¯å¦æ­£ç¡®
echo $DATABASE_URL

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql $DATABASE_URL -c "SELECT 1;"
```

### é—®é¢˜ 2ï¼šPrisma Client æœªç”Ÿæˆ

**ç—‡çŠ¶ï¼š** é”™è¯¯ä¿¡æ¯åŒ…å« "Cannot find module '@prisma/client'"

**è§£å†³ï¼š**
```bash
npx prisma generate
npm install
```

### é—®é¢˜ 3ï¼šbcryptjs æœªå®‰è£…

**ç—‡çŠ¶ï¼š** é”™è¯¯ä¿¡æ¯åŒ…å« "Cannot find module 'bcryptjs'"

**è§£å†³ï¼š**
```bash
npm install bcryptjs
npm install --save-dev @types/bcryptjs
```

### é—®é¢˜ 4ï¼šä»£ç æœªæ›´æ–°

**ç—‡çŠ¶ï¼š** æ³¨å†Œ API ä»ä½¿ç”¨æ—§ä»£ç ï¼ˆlocalStorageï¼‰

**è§£å†³ï¼š**
```bash
git pull
rm -rf .next
npm run build
pm2 restart baozhong-forum
```

## ğŸ“‹ è¯·æŠŠä»¥ä¸‹ä¿¡æ¯å‘ç»™æˆ‘ï¼š

1. **æ­¥éª¤ 2 çš„è¾“å‡º** - DATABASE_URL æ˜¯å¦æ­£ç¡®é…ç½®
2. **æ­¥éª¤ 3 çš„ç»“æœ** - æ•°æ®åº“è¿æ¥æ˜¯å¦æˆåŠŸ
3. **æ­¥éª¤ 8 çš„è¾“å‡º** - API ç›´æ¥è°ƒç”¨çš„é”™è¯¯ä¿¡æ¯
4. **æ­¥éª¤ 9 çš„ä¿¡æ¯** - æµè§ˆå™¨ Network æ ‡ç­¾ä¸­çš„è¯·æ±‚è¯¦æƒ…
5. **æ­¥éª¤ 10 çš„é”™è¯¯æ—¥å¿—** - æœåŠ¡å™¨ç«¯çš„é”™è¯¯ä¿¡æ¯

æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘å°±èƒ½å‡†ç¡®å®šä½é—®é¢˜æ‰€åœ¨ï¼

