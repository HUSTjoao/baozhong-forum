// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String   @id @default(cuid())
  email          String   @unique
  username       String?  @unique
  password       String
  role           String?
  universityId   String?
  graduationYear String?
  major          String?
  gender         String?
  avatarUrl      String?
  nickname       String?
  bio            String?
  isMuted        Boolean  @default(false)
  createdAt      DateTime @default(now())

  questions            Question[]           @relation("UserQuestions")
  replies              Reply[]              @relation("UserReplies")
  alumniMessages       AlumniMessage[]
  questionLikes        QuestionLike[]
  replyLikes           ReplyLike[]
  alumniMessageLikes   AlumniMessageLike[]
}

model University {
  id            String   @id
  name          String
  level         String?
  location      String?
  province      String?
  city          String?
  description   String?
  logoUrl       String?
  isUserAdded   Boolean  @default(false)
  isApproved    Boolean? @default(true)
  reviewStatus  String?
  creatorId     String?
  createdAt     DateTime @default(now())

  questions      Question[]
}

model Major {
  id                 String   @id
  name               String
  category           String
  description        String
  hotScore           Int      @default(0)
  isUserAdded        Boolean  @default(false)
  isApproved         Boolean? @default(true)
  reviewStatus       String?
  creatorId          String?
  strongUniversities String[] @default([])
  createdAt          DateTime @default(now())

  questions          Question[]
}

model Question {
  id           String   @id
  title        String
  content      String
  askerName    String
  isAnonymous  Boolean  @default(false)
  date         DateTime @default(now())
  likes        Int      @default(0)
  repliesCount Int      @default(0)
  category     String?

  universityId String?
  majorId      String?
  askerId      String?

  university   University? @relation(fields: [universityId], references: [id])
  major        Major?      @relation(fields: [majorId], references: [id])
  asker        User?       @relation("UserQuestions", fields: [askerId], references: [id])

  replies      Reply[]
  likesRel     QuestionLike[]
}

model Reply {
  id            String   @id
  content       String
  date          DateTime @default(now())
  likes         Int      @default(0)
  isAnonymous   Boolean  @default(false)
  replierName   String?

  questionId    String
  replierId     String?
  parentReplyId String?

  question      Question @relation(fields: [questionId], references: [id])
  replier       User?    @relation("UserReplies", fields: [replierId], references: [id])

  parent        Reply?   @relation("ReplyToReply", fields: [parentReplyId], references: [id])
  children      Reply[]  @relation("ReplyToReply")

  likesRel      ReplyLike[]
}

model QuestionLike {
  id         Int      @id @default(autoincrement())
  questionId String
  userId     String
  createdAt  DateTime @default(now())

  question   Question @relation(fields: [questionId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([questionId, userId])
}

model ReplyLike {
  id        Int      @id @default(autoincrement())
  replyId   String
  userId    String
  createdAt DateTime @default(now())

  reply     Reply @relation(fields: [replyId], references: [id])
  user      User  @relation(fields: [userId], references: [id])

  @@unique([replyId, userId])
}

model AlumniMessage {
  id         String   @id
  userId     String
  content    String
  likes      Int      @default(0)
  createdAt  DateTime @default(now())
  isApproved Boolean? @default(true)

  user       User                 @relation(fields: [userId], references: [id])
  likesRel   AlumniMessageLike[]
}

model AlumniMessageLike {
  id        Int      @id @default(autoincrement())
  messageId String
  userId    String
  createdAt DateTime @default(now())

  message   AlumniMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id])

  @@unique([messageId, userId])
}

model Report {
  id           String   @id
  type         String
  targetId     String
  targetTitle  String?
  targetContent String
  reason       String
  reporterId   String
  reporterName String
  status       String   @default("pending")
  questionId   String
  date         DateTime @default(now())
}
